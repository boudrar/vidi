Marionette.Module=function(t,i,e){this.moduleName=t,this.options=_.extend({},this.options,e),this.initialize=e.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=i,_.isFunction(this.initialize)&&this.initialize(t,i,this.options)},Marionette.Module.extend=Marionette.extend,_.extend(Marionette.Module.prototype,Backbone.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(t){this._initializerCallbacks.add(t)},addFinalizer:function(t){this._finalizerCallbacks.add(t)},start:function(t){this._isInitialized||(_.each(this.submodules,function(i){i.startWithParent&&i.start(t)}),this.triggerMethod("before:start",t),this._initializerCallbacks.run(t,this),this._isInitialized=!0,this.triggerMethod("start",t))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),_.each(this.submodules,function(t){t.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(t,i){this._runModuleDefinition(t,i)},_runModuleDefinition:function(t,i){if(t){var e=_.flatten([this,this.app,Backbone,Marionette,Backbone.$,_,i]);t.apply(this,e)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new Marionette.Callbacks,this._finalizerCallbacks=new Marionette.Callbacks},triggerMethod:Marionette.triggerMethod}),_.extend(Marionette.Module,{create:function(t,i,e){var n=t,a=slice.call(arguments);a.splice(0,3),i=i.split(".");var s=i.length,r=[];return r[s-1]=e,_.each(i,function(i,s){var o=n;n=this._getModule(o,i,t,e),this._addModuleDefinition(o,n,r[s],a)},this),n},_getModule:function(t,i,e,n){var a=_.extend({},n),s=this.getClass(n),r=t[i];return r||(r=new s(i,e,a),t[i]=r,t.submodules[i]=r),r},getClass:function(t){var i=Marionette.Module;return t?t.prototype instanceof i?t:t.moduleClass||i:i},_addModuleDefinition:function(t,i,e,n){var a=this._getDefine(e),s=this._getStartWithParent(e,i);a&&i.addDefinition(a,n),this._addStartWithParent(t,i,s)},_getStartWithParent:function(t,i){var e;return _.isFunction(t)&&t.prototype instanceof Marionette.Module?(e=i.constructor.prototype.startWithParent,_.isUndefined(e)?!0:e):_.isObject(t)?(e=t.startWithParent,_.isUndefined(e)?!0:e):!0},_getDefine:function(t){return!_.isFunction(t)||t.prototype instanceof Marionette.Module?_.isObject(t)?t.define:null:t},_addStartWithParent:function(t,i,e){i.startWithParent=i.startWithParent&&e,i.startWithParent&&!i.startWithParentIsConfigured&&(i.startWithParentIsConfigured=!0,t.addInitializer(function(t){i.startWithParent&&i.start(t)}))}});